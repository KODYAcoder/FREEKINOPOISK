<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<link rel="icon" href="assets/favicon.png">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kinopoisk Watch</title>
	<link rel="stylesheet" href="assets/style.css">
	<script defer data-domain="kirlovon.dev/kinopoisk-watch" src="https://plausible.io/js/plausible.js"></script>
</head>

<body>
	<a id="logo" href="https://github.com/Kirlovon/Kinopoisk-Watch" target="_blank">
		<img src="assets/logo.svg">
	</a>

	<div id="container">
		<div id="yohoho" data-resize="1" data-bg="#000000" data-loading="assets/loading.webp"></div>
	</div>

	<span id="info">
		Made with ♥ by <a href="https://github.com/Kirlovon" target="_blank">Kirlovon</a>.
		Powered by <a href="https://yohoho.cc/" target="_blank">Yohoho</a>.
	</span>

	<script>
		const container = document.getElementById('container');
		const yohoho = document.getElementById('yohoho');
		let isLoaded = false;

		// Initialize player
		function init() {

			// Get ID from search params
			const params = new URLSearchParams(window.location.search);
			let id = params.get('id');

			// Get ID from hash (for old versions)
			if (!id) {
				const hash = window.location.hash.replace(/\D/g, '');
				if (hash !== '') id = hash;
			}

			if (id) {
				yohoho.setAttribute('data-kinopoisk', id);
			} else {
				container.innerText = 'ID фильма не указаны!';
			}
		}

		// Listen for loading events
		document.addEventListener('DOMContentLoaded', () => {
			window.addEventListener('message', (event) => {
				if (!event || !event.data) return;
				if (event.data.event === 'playerReady') isLoaded = true;
				if (event.data.quality === '' || event.data.translate === '') isLoaded = true;
			});

			window.addEventListener('load', () => {
				setTimeout(() => {
					if (!isLoaded) {
						const scriptAttached = !!(document.getElementById('yohoho-iframe') || document.getElementById('yohoho-loading'));
						container.innerText = scriptAttached ? 'Фильм не найден!' : 'Не удалось загрузить плеер!';
					}
				}, 2500);
			});
		});

		init();

	</script>

	<script defer data-domain="kirlovon.dev/kinopoisk-watch" src="https://plausible.io/js/plausible.js"></script>
	<script src="//yohoho.cc/yo.js"></script>
</body>

</html>